<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="CBReader" />
<!--<meta property="og:image" content="" />-->
<meta property="og:description" content="" />
<meta property="og:url" content="https://github.com/awilderin/cbreader" />
<!-- END opengraph metadata -->
<!-- BEGIN twitter metadata -->
<!--<meta name="twitter:image:src" content="" />-->
<meta name="twitter:title" content="CBReader" />
<meta name="twitter:description" content="" />
<!-- END twitter metadata -->
<title>CBReader: RMesh Structure</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" type="image/svg+xml" href="logo.drawio.svg"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
</script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/awilderin/cbreader" class="github-corner" title="View source on GitHub" target="_blank" rel="noopener noreferrer">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBReader
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part --><!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d8/def/md_docs_pages_RMesh_Structure.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">RMesh Structure </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A Room Mesh (rmesh) file is the main room file in <a href="https://scpcbgame.com/">SCP: Containment Breach</a>. It is a basic mesh format designed to be house the room's mesh and baked entities.</p>
<p>The rmesh comprises of 5 main chunks of data:</p><ul>
<li>The header - Provides basic data about the mesh, such as whether or not it contains trigger boxes.</li>
<li>The drawn mesh - The visual part of the mesh.</li>
<li>The collision mesh - Not every room mesh has this, it's designed to add more collision for things like stairs or the HCZ tunnels.</li>
<li>Trigger boxes - A list of trigger boxes which are used by the game code to handle certain events.</li>
<li>Entities - Rooms have a specific list of entities that are baked in to the level, such as lights, models, sound emitters, screens and waypoints</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Structure</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Types</h2>
<h3><a class="anchor" id="autotoc_md8"></a>
Vertex</h3>
<p>A vertex is a struct that describes a mesh vertex. The structure of a vertex is:</p><ul>
<li>X - float.</li>
<li>Y - float.</li>
<li>Z - float.</li>
<li>UV X - float.</li>
<li>UV Y - float.</li>
<li>Lightmap UV X - float.</li>
<li>Lightmap UV Y - float.</li>
<li>R - byte</li>
<li>G - byte</li>
<li>B - byte</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Triangle</h2>
<p>A triangle is a struct of 3 uint32's that define what vertices are apart of the specified triangle.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Surface</h3>
<p>A surface is a struct that describes a collection of triangles and vertices of the mesh. Surfaces are broken up by textures, meaning that all faces using the same texture are separated into 1 big surface.</p>
<p>A surface structure is as followed:</p><ul>
<li>Textures[2] - The first is usually the texture of the surface, and the second is usually the lightmap texture.</li>
<li>Vertex Count - The count of all the vertices. Type is uint32.</li>
<li>Vertices[Vertex Count] - An array of all the vertices for this surface.</li>
<li>Triangle Count - The count of all the triangles. Type is uint32.</li>
<li>Triangles[Triangle Count] - All the triangles for this surface.</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Texture</h2>
<p>A texture is a basic struct containing a blend type and texture name. The texture name is only present when the blend type does not equal zero (0).</p>
<p>NOTE: I'm not exactly sure what blend type is or what it's values are</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Header</h2>
<p>The header is a size (uint32) prefixed string, usually it is either <code>RoomMesh</code> or <code>RoomMesh.HasTriggerBox</code>. (In SCP:CB NTF, they extended this to add <code>.HasNoColl</code>)</p>
<div class="fragment"><div class="line">std::uint32_t headerSize;</div>
<div class="line">std::string headerText;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
Drawn Mesh</h2>
<p>The drawn mesh is the visual mesh that is rendered with textures, but is also used for general collision geometry alongside the collision mesh. It comprises of an array of surfaces, each of which describes a collection of vertices and triangles broken up by texture.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Collision Mesh</h2>
<p>The collision mesh is similar to the drawn mesh, except it is not drawn and is used purely for collision. Not every room mesh has collision mesh surfaces, but notable rooms are 173's chamber for the stairs, and various HCZ rooms to stop the player from walking up the sides.</p>
<p>An important difference between the drawn mesh and the collision mesh, is that the surface vertices are only the vertex positions. They do not contain any UV or color data.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Trigger boxes</h2>
<p>Trigger boxes are collision meshes with a name, they used by the same to handle starting certain events. A room mesh only has trigger boxes if the header contains <code>.HasTriggerBox.</code></p>
<p>Inside the rmesh, they are an array that starts with the size of the array, similar to how surfaces are defined.</p>
<p>The structure for a trigger boxes is:</p><ul>
<li>Collision Mesh - The actual mesh for the trigger box</li>
<li>Name - A length prefixed string containing the name that is used by the game code.</li>
</ul>
<h2><a class="anchor" id="autotoc_md16"></a>
Entities</h2>
<p>Various entities are baked into the room mesh file. They are defined in an array that starts with the entity count. The first value of an entity is always the entities class name (A length prefixed string), and the class name is used to dictate how to read the entity's binary data as they are not in any specific order.</p>
<p>Below are the structure of various entities</p>
<h3><a class="anchor" id="autotoc_md17"></a>
Screen</h3>
<p>A screen is a CB entity that displays a PNG on the player's view, usually hinting at lore for SCP:CB.</p>
<ul>
<li>Position X - float.</li>
<li>Position Y - float.</li>
<li>Position Z - float.</li>
<li>Image path - A length prefixed string that contains the image path.</li>
</ul>
<h3><a class="anchor" id="autotoc_md18"></a>
Waypoint</h3>
<p>Waypoints are used the the in-game AI.</p>
<ul>
<li>Position X - float.</li>
<li>Position Y - float.</li>
<li>Position Z - float.</li>
</ul>
<h3><a class="anchor" id="autotoc_md19"></a>
Light</h3>
<p>Despite lightmaps being baked, light entities are also baked into the room and spawned in game. If X, Y or Z is equal to zero, the light entity does not have range, color or intensity.</p>
<ul>
<li>Position X - float.</li>
<li>Position Y - float.</li>
<li>Position Z - float.</li>
<li>Range - float. Range of the light. SCP:CB calculates this as <code>Range/2000.f</code> when creating the light in game.</li>
<li>Color - Length prefixed string containing the RGB values. (Yes it's a string, I'm not sure why..)</li>
<li>Intensity - float. Intensity value of the light. In-game, SCP:CB uses this as <code>Min(Intensity*0.8,1.0)</code></li>
</ul>
<h3><a class="anchor" id="autotoc_md20"></a>
Spotlight</h3>
<p>Similar to lights, spotlights are also baked into the room mesh. If X, Y or Z is equal to zero, the spotlight entity does not have range, color, intensity, angles, inner or outer cone angles.</p>
<ul>
<li>Position X - float.</li>
<li>Position Y - float.</li>
<li>Position Z - float.</li>
<li>Range - float. Range of the light. SCP:CB calculates this as <code>Range/2000.f</code> when creating the light in game.</li>
<li>Color - Length prefixed string containing the RGB values. (Yes it's a string, I'm not sure why..)</li>
<li>Intensity - float. Intensity value of the light. In-game, SCP:CB uses this as <code>Min(Intensity*0.8,1.0)</code></li>
<li>Angle - Length prefixed string containing the pitch, yaw and roll. Only pitch and yaw are used in-game.</li>
<li>Inner cone angle - uint32. Defines the inner cone angle for the spotlight</li>
<li>Outer cone angle - uint32. Defines the outer cone angle for the spotlight</li>
</ul>
<h3><a class="anchor" id="autotoc_md21"></a>
Sound Emitter</h3>
<p>A sound emitter is an entity that plays a sound. NOTE: This isn't complete as I don't fully understand the code surrounding the sound emitter entities.</p>
<ul>
<li>Position X - float.</li>
<li>Position Y - float.</li>
<li>Position Z - float.</li>
<li>Sound - uint32.</li>
<li>Range - float.</li>
</ul>
<h3><a class="anchor" id="autotoc_md22"></a>
Player start</h3>
<p>This entity is used to teleport the player when the room is loaded</p><ul>
<li>Position X - float.</li>
<li>Position Y - float.</li>
<li>Position Z - float.</li>
<li>Angle - Length prefixed string containing the pitch, yaw and roll.</li>
</ul>
<h3><a class="anchor" id="autotoc_md23"></a>
Model</h3>
<p>A model entity that, when the room is loaded, spawns the mesh from the path and rotates, positions and scales it based on this entity's data.</p>
<ul>
<li>Path - A length prefixed string that has a path to the model this entity uses.</li>
<li>Position X - float.</li>
<li>Position Y - float.</li>
<li>Position Z - float.</li>
<li>Pitch - float.</li>
<li>Yaw - float.</li>
<li>Roll - float.</li>
<li>Scale X - float.</li>
<li>Scale Y - float.</li>
<li>Scale Z - float. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
